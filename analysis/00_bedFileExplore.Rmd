---
title: "00_bedFileExplore"
author: "Caitlin Page"
date: "2025-06-06"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: inline
---

## Introduction

```{r}
library(rtracklayer)
library(NanoMethViz)

library(dplyr)
library(ggplot2)
```

```{r}
list_bed <- paste0("../data/cfnano_paper/bed/", list.files("../data/cfnano_paper/bed"))
```

```{r}
import.bed(list_bed[1])
```
Column 11 corresponds to the percent of reads methylated. Modbam2bed does not provide a column for the actual number of reads that this percentage is based on, but it can be calculated from the other columns. readCount=(col5*col10)/1000

```{r}
try_bed <- import.bed(list_bed[1]) %>% data.frame()
try_bed
```

```{r}
summary(try_bed$score)
summary(try_bed$blockCount)
summary(as.double(try_bed$blockSizes))
```
% is out of 100 so that must mean blockSizes: so beta = blockSizes
which means 5 must be score and 10 must be blockCount

```{r}
try_bed$readCount <- (try_bed$score*try_bed$blockCount)/1000
```
```{r}
try_bed
```


```{r}
list.files("../data/cfnano_paper")
```

```{r}
import.bedGraph(paste0("../data/cfnano_paper/", list.files("../data/cfnano_paper"))[2])
import.bedGraph(paste0("../data/cfnano_paper/", list.files("../data/cfnano_paper"))[2]) %>% data.frame()
```
* bed file is better - has more detail

* but neither bed or bedgraph has the fragment length information
* and that is bad
* because one of first things we wanted was fragment length
* could plot meth values across though

# nanomethviz
https://bioconductor.org/packages/release/bioc/vignettes/NanoMethViz/inst/doc/UsersGuide.html 
* tabix format methylation values
* exon annotation
* sample annotation
```{r}
exon_anno <- get_exons_hg38()
```

```{r}
try_bed
```
```{r}
viz_bed <- try_bed %>% mutate(sample = "a", chr = seqnames, pos = start, statistic = as.double(blockSizes)) %>% .[,c(15,16,17,5,18)]
```
```{r}
samples <- cbind(sample = "a", group = "healthy") %>% data.frame()
```

```{r}
NanoMethResult(viz_bed, samples, exon_anno)
```

```{r}
plot_gene(NanoMethResult(viz_bed, samples, exon_anno), "AIBG")
```

# bams
* downloading bams
* is there any other way to figure out the fragment lengths?
